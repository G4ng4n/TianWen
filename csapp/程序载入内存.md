# 思考题：程序载入内存

> 说明过程中发生了什么

大致上应当分为读取程序的描述信息，分配内存，根据描述信息将程序读取到内存，最后跳转到入口处执行，

- 首先loader向内核申请一个空闲的进程结构体，内核会去初始化结构体（xv6里面是Env），结构体用于内核的进程管理。
  - 初始化结构体的过程中，内核需要为结构体对应进程设置内核虚拟内存空间，首先内核申请一个物理页用于存储进程的页目录，再将页目录设置用户读权限后填入进程结构体；同时设置进程的地址空间的内核部分
- loader拿到返回的结构体后（在拿到之前应该也可以），在磁盘上打开目标程序的文件，读ELF文件头和程序段头表，计算程序段的大小